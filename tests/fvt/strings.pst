void runner() {
    testCharCode();
    testCharacters();
    testCompare();
    testConcatAll();
    testFind();
    testLowerUpper();
    testReplace();
    testReverse();
    testSlicingAndDicing();
    testSplit();
    testStartsEndsWith();
    testSubStringEqual();
    testTrim();
}

void testLowerUpper() {
    string s = ""
        + "abc XYZ 123 .?" // ASCII
        + " ëËæÆçÇìÌ" // accents
        + " あ ア 阿 아" // CJK

        // TODO: behavior for cyrillic is different in various target languages
        // + " А" // Cyrillic
        ;

    assertEqStr("ABC XYZ 123 .? ËËÆÆÇÇÌÌ あ ア 阿 아", s.toUpper());
    assertEqStr("abc xyz 123 .? ëëææççìì あ ア 阿 아", s.toLower());
}

void testTrim() {
    string FW_SPACE = ""; // "　";
    string padding = " \r\n\t" + FW_SPACE;
    string testStr = padding + "." + padding;
    assertEqStr(
        readableWrap("."),
        readableWrap(testStr.trim()));
    assertEqStr(
        readableWrap("." + padding),
        readableWrap(testStr.trimStart()));
    assertEqStr(
        readableWrap(padding + "."),
        readableWrap(testStr.trimEnd()));
}

void testReverse() {
    assertEqStr("321 cba", "abc 123".reverse());
    assertEqStr("おえういあ 321 cba", "abc 123 あいうえお".reverse());
}

void testCharacters() {
    char c = 'x';
    int charCode = Convert.charToCharCode(c);
    assertEqInt(charCode, 96 + 24);
    char cRoundTrip = Convert.charCodeToChar(charCode + 1);
    assertEqChar('y', cRoundTrip);

    assertEqStr("yz", cRoundTrip + "z");
    assertEqStr("xy", "x" + cRoundTrip);

    string zero = "零";
    string foo = zero + "1234";

    char c2 = foo[2];
    assertEqStr("2", "" + c2);

    char c0 = foo[0];
    assertEqStr(zero, "" + c0);
}

string readableWrap(string v) {
    return "[" + v + "]";
}

void testConcatAll() {
    // Not a good way to check but look at the generated code to see if this whole line is concatenated into a single StringBuilder pattern, if applicable.
    string val = "a" + passThruInt(2) + "c" + passThruInt(4) + "e";
    assertEqStr("a2c4e", val);
}

void testSlicingAndDicing() {
    string nums = "012三4五67八9";
    assertEqInt(10, nums.size());
    assertEqStr("012", nums.subString(0, 3));
    assertEqStr("012三", nums.subString(0, 4));
    assertEqStr("三4五6", nums.subString(3, 4));
}

void testStartsEndsWith() {
    string haystack = "0123456";
    assertTrue(haystack.startsWith("012"));
    assertTrue(haystack.endsWith("456"));
    assertFalse(haystack.startsWith("1"));
    assertFalse(haystack.endsWith("5"));
}

void testCompare() {
    string a = "A";
    string b = "B";
    string b2 = b;
    assertFalse(Deprecated.stringCompareIsReverse(a, b));
    assertTrue(Deprecated.stringCompareIsReverse(b, a));
    assertFalse(Deprecated.stringCompareIsReverse(b, b2));
}

void testCharCode() {
    string s = "abc";
    assertEqInt(98, s.charCodeAt(1));
}

void testSplit() {
    string toSplit = "this is  a string ";
    string[] parts = toSplit.split(" ");
    assertEqInt(6, parts.size());
    assertEqStr("this", parts[0]);
    assertEqStr("", parts[2]);
    assertEqStr("", parts[5]);
    assertEqStr("string", parts[4]);
}

void testSubStringEqual() {
    string test = "0123456789";
    assertTrue(test.subStringIsEqualTo(0, "012"));
    assertTrue(test.subStringIsEqualTo(8, "89"));
    assertTrue(test.subStringIsEqualTo(4, ""));
    assertTrue(test.subStringIsEqualTo(0, "0123456789"));
    assertFalse(test.subStringIsEqualTo(1, "0123"));
}

void testReplace() {
    string test = "12345";
    string testSequences = "aaaaa";
    // TODO: test accidentally-regex
    assertEqStr("12THREE & FOUR5", test.replace("34", "THREE & FOUR"));
    assertEqStr("12THREE & FOUR5", test.replace("34", "THREE & FOUR"));
    assertEqStr("bba", testSequences.replace("aa", "b"));
}

void testFind() {
    string test = "0123456789";
    string twenty = test + test;
    assertEqInt(-1, twenty.indexOf("543"));
    assertEqInt(0, twenty.indexOf("0123"));
    assertEqInt(10, twenty.lastIndexOf("0123"));
    assertEqInt(3, twenty.indexOf("34"));
    assertEqInt(3, twenty.indexOf("34", 3));
    assertEqInt(13, twenty.indexOf("34", 4));
}
